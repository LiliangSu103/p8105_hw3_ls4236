---
title: "p8105_hw3_ls4236"
author: "Liliang Su"
date: "2025-10-04"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

Load the data

```{r}
data("instacart")
```

### Dataset Exploration and description

Firstly explore the data and check missing values.
```{r}
str(instacart)
sum(is.na(instacart))
```

Here is a brief description about `instacart` dataset:

- **Structure**: The dataset contains `r nrow(instacart)` observations (rows) and `r ncol(instacart)` dimentions (columns), with no missing data. Each row represents a single product added to a customer's grocery cart, while each column specifies certain information about the order.
- **Key variables**: 
  - `order_id`, `user_id`: Unique identifier for orders and users.
  - `product_id`, `product_name`: Identify the ordered item and its name.
  - `reorder`: Whether the user had placed orders containing this product before.
  - `order_dow`, `order_hour_of_day`: Day of a week and specific hour the order was placed.
  - `department`, `department_id`, `aisle`, `aisle_id`: Specific aisle and department (along with their IDs) the product belongs to.
- **Illustrative examples**:
  - One observation from the dataset details a customer (User #112108) who placed their 4th order on a Thursday at 10:00 AM, starting their shopping with Bulgarian Yogurt, which is located at Yogurt aisle, Dairy & Eggs department. This item was listed as reordered, indicating the customer had purchased it before, which reflects a habitual buying pattern for this everyday dairy product. The order occurred just 9 days after their previous one, suggesting a relatively frequent and consistent shopping rhythm. This example illustrates how the dataset captures routine purchasing behavior for staple grocery items.

### Answers for questions

```{r}
byaisle_df = instacart |> 
  group_by(aisle) |> 
  summarise(n = n()) |> 
  arrange(desc(n))
```

1. There are in total `r byaisle_df |> nrow()` aisles in the dataset, and the `r byaisle_df[1,1]` aisle are the most items ordered from.

2. The required graph is shown below, which is a bar plot with aisle_id on the x-axis and the number of items on the y-axis.

```{r}
instacart |> 
  group_by(aisle_id) |> 
  summarise(n = n()) |> 
  filter(n > 10000) |> 
  ggplot(aes(x = reorder(aisle_id, n), y = n)) +
  geom_col() +
  labs(title = "Number of Items Ordered by Aisle (>10,000)", 
       x = "Aisle ID", 
       y = "Number of Items") +
  theme(
    axis.text.x = element_text(size = 8)
  )
  
```

3. The required table is shown below.

```{r}
instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |>
  group_by(aisle, product_name) |> 
  summarise(n = n()) |> 
  slice_max(order_by = n, n = 3) |> 
  arrange(aisle, desc(n)) |> 
  knitr::kable(digits = 2)

```

4. The required table is shown below.

```{r}
instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarise(mean_hour = mean(order_hour_of_day)) |> 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) |> 
  knitr::kable(digits = 2)


```

